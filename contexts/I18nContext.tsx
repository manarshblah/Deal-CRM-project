import React, { createContext, useState, useContext, ReactNode, useEffect } from 'react';

// Basic translations
const translations: Record<string, Record<string, string>> = {
  en: {
    dashboard: 'Dashboard',
    leads: 'Leads',
    all_leads: 'All Leads',
    my_leads: 'My Leads',
    fresh_leads: 'Fresh Leads',
    rotated_leads: 'Rotated Leads',
    cold_leads: 'Cold Leads',
    deals: 'Deals',
    activities: 'Activities',
    todos: 'Todos',
    users: 'Users',
    inventory: 'Inventory',
    units: 'Units',
    owners: 'Owners',
    marketing: 'Marketing',
    campaigns: 'Campaigns',
    reports: 'Reports',
    teams_report: 'Teams Report',
    employees_report: 'Employees Report',
    marketing_report: 'Marketing Report',
    settings: 'Settings',
    owner: 'Owner',
    change_password: 'Change Password',
    logout: 'Logout',
    today_new_leads: "Today's New Leads",
    today_touched_leads: "Today's Touched Leads",
    today_untouched_leads: "Today's Untouched Leads",
    delayed_leads: "Delayed Leads",
    week_leads: "This Week's Leads",
    stages_report: "Stages Report",
    no_data_available: 'No Data Available',
    latest_feedbacks: "Latest Feedbacks",
    date: 'Date',
    agent: 'Agent',
    client: 'Client',
    stage: 'Stage',
    feedback: 'Feedback',
    no_answer: 'No Answer',
    meeting: 'Meeting',
    top_users: "Top Users",
    admin: 'Admin',
    team_leader: 'Team Leader',
    sales: 'Sales',
    hello_deal_crm: "Hello in Deal CRM",
    login_desc: "The best CRM to manage your real estate business with the least effort.",
    arabic_lang: "اللغة العربية",
    english_lang: "English",
    welcome_back: "Welcome Back!",
    login_prompt: "Please sign in to your account.",
    username: "Username",
    admin_placeholder: "e.g. admin",
    password: "Password",
    password_placeholder: "e.g. admin123",
    sign_in: "Sign In",
    users_count: "Users ({{count}})",
    add_user: "Add User",
    auto_assignment_status: "Auto Assignment Status",
    call: "Call",
    whatsapp: "WhatsApp",
    edit_user: "Edit User",
    reset_password: "Reset Password",
    delete_user: "Delete User",
    create_lead: "Create Lead",
    lead_name: "Lead Name",
    phone: "Phone",
    status: "Status",
    user: "User",
    actions: "Actions",
    all_users: 'All Users',
    time_period: 'Time Period',
    today: 'Today',
    last_week: 'Last Week',
    this_month: 'This Month',
    leads_type: 'Leads Type',
    all: 'All',
    activity_type: 'Activity Type',
    calls: 'Calls',
    emails: 'Emails',
    meetings: 'Meetings',
    add_activity: 'Add Activity',
    no_activities_found: 'No activities found.',
    details: 'Details',
    add_unit: 'Add Unit',
    project: 'Project',
    developer: 'Developer',
    price: 'Price',
    create_deal: 'Create Deal',
    total_value: 'Total Value',
    closed_date: 'Closed Date',
    deal_information: 'Deal Information',
    select_project: 'Select Project',
    select_unit: 'Select Unit',
    lead: 'Lead',
    select_lead: 'Select Lead',
    started_by: 'Started By',
    select_user: 'Select User',
    closed_by: 'Closed By',
    payment_method: 'Payment Method',
    select_method: 'Select Method',
    select_status: 'Select Status',
    start_date: 'Start Date',
    select_start_date: 'Select Start Date',
    select_closed_date: 'Select Closed Date',
    discount_percentage: 'Discount (%)',
    enter_discount_percentage: 'Enter Discount Percentage',
    discount_amount: 'Discount Amount',
    description: 'Description',
    sales_commission_percentage: 'Sales Commission (%)',
    enter_commission_percentage: 'Enter Commission Percentage',
    sales_commission_amount: 'Sales Commission Amount',
    enter_deal_description: 'Enter deal description',
    add_campaign: 'Add Campaign',
    campaign_name: 'Campaign Name',
    platform: 'Platform',
    cost: 'Cost',
    all_todos: 'All Todos',
    add_todo: 'Add Todo',
    no_tasks_found: 'No tasks found for the selected day.',
    week_overview: 'Week Overview',
    coming_soon: 'Coming Soon',
    owners_page_desc: 'This page is under construction and will be available soon.',
    total_spend: 'Total Spend',
    cost_per_lead: 'Cost Per Lead',
    filter_reports: 'Filter Reports',
    date_start: 'Date Start',
    date_end: 'Date End',
    teams: 'Teams',
    all_teams: 'All Teams',
    employee: 'Employee',
    all_employees: 'All Employees',
    team: 'Team',
    total_leads: 'Total Leads',
    touched_leads_report: 'Touched Leads',
    meetings_report: 'Meetings',
    deals_report: 'Deals',
    total_value_report: 'Total Value',
    channels: 'Channels',
    stages: 'Stages',
    statuses: 'Statuses',
    lead_assignment_settings: 'Lead Assignment Settings',
    lead_assignment_desc: 'Configure how leads are assigned and managed in your workflow.',
    enable_auto_rotation_delayed: 'Enable Auto Rotation for Delayed Leads',
    auto_rotation_delayed_desc: "Automatically reassign leads that haven't been attended to within the delay time.",
    reminder_delay_time: 'Reminder Delay Time (Minutes)',
    reminder_delay_desc: 'Time to wait before marking a lead as delayed.',
    save_settings: 'Save Settings',
    integrations: 'Integrations',
    name: 'Name',
    email: 'Email',
    role: 'Role',
    save: 'Save',
    cancel: 'Cancel',
    channel_management_settings: 'Channel Management Settings',
    channel_management_desc: 'Configure and manage your lead generation channels.',
    enable_multi_channel_tracking: 'Enable Multi-Channel Lead Tracking',
    multi_channel_tracking_desc: 'Allow leads to be tracked across multiple channels.',
    default_channel: 'Default Channel',
    default_channel_desc: 'Default channel for new leads when source is unknown.',
    active_channels: 'Active Channels',
    add_channel: 'Add Channel',
    priority: 'Priority',
    channel_name: 'Channel Name',
    lead_stages_settings: 'Lead Stages Settings',
    lead_stages_desc: 'Configure and manage your lead progression stages.',
    enable_auto_stage_advancement: 'Enable Auto Stage Advancement',
    auto_stage_advancement_desc: 'Automatically advance leads to next stage when conditions are met.',
    require_stage_completion: 'Require Stage Completion',
    require_stage_completion_desc: 'Require all required stages to be completed in order.',
    lead_stages: 'Lead Stages',
    add_stage: 'Add Stage',
    stage_name: 'Stage Name',
    color: 'Color',
    required: 'Required',
    auto_advance: 'Auto Advance',
    lead_status_settings: 'Lead Status Settings',
    lead_status_desc: 'Configure and manage lead status options for better tracking.',
    enable_custom_statuses: 'Enable Custom Statuses',
    custom_statuses_desc: 'Allow users to create and use custom status options.',
    require_status_updates: 'Require Status Updates',
    require_status_updates_desc: 'Require agents to update status when working with leads.',
    default_active_status: 'Default Active Status',
    default_active_status_desc: 'Default status assigned to new leads.',
    available_statuses: 'Available Statuses',
    add_status: 'Add Status',
    status_name: 'Status Name',
    category: 'Category',
    default_status_no_delete: 'Default Status - Cannot be deleted',
  },
  ar: {
    dashboard: 'لوحة التحكم',
    leads: 'العملاء المحتملون',
    all_leads: 'كل العملاء',
    my_leads: 'عملائي',
    fresh_leads: 'عملاء جدد',
    rotated_leads: 'عملاء معاد توجيههم',
    cold_leads: 'عملاء غير نشطين',
    deals: 'الصفقات',
    activities: 'الأنشطة',
    todos: 'المهام',
    users: 'المستخدمون',
    inventory: 'المخزون',
    units: 'الوحدات',
    owners: 'الملاك',
    marketing: 'التسويق',
    campaigns: 'الحملات',
    reports: 'التقارير',
    teams_report: 'تقرير الفرق',
    employees_report: 'تقرير الموظفين',
    marketing_report: 'تقرير التسويق',
    settings: 'الإعدادات',
    owner: 'مالك',
    change_password: 'تغيير كلمة المرور',
    logout: 'تسجيل الخروج',
    today_new_leads: "عملاء اليوم الجدد",
    today_touched_leads: "عملاء تم التواصل معهم اليوم",
    today_untouched_leads: "عملاء لم يتم التواصل معهم اليوم",
    delayed_leads: "العملاء المتأخرون",
    week_leads: "عملاء هذا الأسبوع",
    stages_report: "تقرير المراحل",
    no_data_available: 'لا توجد بيانات متاحة',
    latest_feedbacks: "أحدث التقييمات",
    date: 'التاريخ',
    agent: 'الموظف',
    client: 'العميل',
    stage: 'المرحلة',
    feedback: 'التقييم',
    no_answer: 'لم يرد',
    meeting: 'اجتماع',
    top_users: "أفضل المستخدمين",
    admin: 'مدير',
    team_leader: 'قائد فريق',
    sales: 'مندوب مبيعات',
    hello_deal_crm: "أهلاً بك في Deal CRM",
    login_desc: "أفضل نظام لإدارة أعمالك العقارية بأقل مجهود.",
    arabic_lang: "اللغة العربية",
    english_lang: "English",
    welcome_back: "مرحباً بعودتك!",
    login_prompt: "الرجاء تسجيل الدخول إلى حسابك.",
    username: "اسم المستخدم",
    admin_placeholder: "مثال: admin",
    password: "كلمة المرور",
    password_placeholder: "مثال: admin123",
    sign_in: "تسجيل الدخول",
  }
};

type Language = 'en' | 'ar';
type Direction = 'ltr' | 'rtl';

interface I18nContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  dir: Direction;
  t: (key: string, options?: { [key: string]: string | number | undefined }) => string;
}

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export const I18nProvider: React.FC<{ children: ReactNode }> = ({ children }) => {
  const [language, setLanguage] = useState<Language>('en');
  const [dir, setDir] = useState<Direction>('ltr');

  useEffect(() => {
    setDir(language === 'ar' ? 'rtl' : 'ltr');
  }, [language]);

  const t = (key: string, options?: { [key: string]: string | number | undefined }) => {
    let translation = translations[language][key] || (options?.defaultValue as string) || key;
    if (options) {
        Object.keys(options).forEach(optionKey => {
            if(optionKey !== 'defaultValue') {
              translation = translation.replace(`{{${optionKey}}}`, String(options[optionKey]));
            }
        });
    }
    return translation;
  };

  return (
    <I18nContext.Provider value={{ language, setLanguage, dir, t }}>
      {children}
    </I18nContext.Provider>
  );
};

export const useI18n = () => {
  const context = useContext(I18nContext);
  if (context === undefined) {
    throw new Error('useI18n must be used within an I18nProvider');
  }
  return context;
};